---
import Layout from "../../layouts/Layout.astro";
import Templates from "../../components/pages/Templates";
import { BOARD_TEMPLATES } from "../../data/templates";

export const prerender = true;

export function getStaticPaths() {
  return BOARD_TEMPLATES.map((template) => ({
    params: { templateId: template.id },
  }));
}

const { templateId } = Astro.params;
const template = BOARD_TEMPLATES.find((t) => t.id === templateId);

if (!template) {
  return Astro.redirect("/404");
}

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: [
    {
      "@type": "ListItem",
      position: 1,
      name: "Home",
      item: "https://clearretro.com/",
    },
    {
      "@type": "ListItem",
      position: 2,
      name: "Templates",
      item: "https://clearretro.com/templates/",
    },
    {
      "@type": "ListItem",
      position: 3,
      name: template.name,
      item: `https://clearretro.com/templates/${templateId}`,
    },
  ],
};

const howToSchema = {
  "@context": "https://schema.org",
  "@type": "HowTo",
  name: `How to run a ${template.name} Retrospective`,
  description: template.description,
  step: [
    {
      "@type": "HowToStep",
      name: "Create Board",
      text: `Start a new board using the ${template.name} template on Clear Retro.`,
      url: `https://clearretro.com/board/new?template=${template.id}`,
    },
    {
      "@type": "HowToStep",
      name: "Brainstorm",
      text: "Invite your team and add cards to the columns.",
    },
    {
      "@type": "HowToStep",
      name: "Vote & Discuss",
      text: "Vote on important items and discuss action items.",
    },
  ],
};
---

<Layout
  title={`${template.name} Retrospective Template | Clear Retro`}
  description={`Free ${template.name} retrospective template. ${template.description} Run unlimited online retrospectives with no login required.`}
>
  <script
    type="application/ld+json"
    slot="head"
    set:html={JSON.stringify([breadcrumbSchema, howToSchema])}
  />
  <div class="min-h-screen bg-white dark:bg-black">
    {/* Hero Section */}
    <div class="relative py-20 overflow-hidden">
      <div
        class="absolute inset-0 bg-grid-pattern opacity-10 pointer-events-none"
      >
      </div>
      <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <a
          href="/"
          class="inline-block mb-8 text-sm font-bold text-brand-600 dark:text-brand-400 hover:underline"
          >‚Üê Back to Home</a
        >

        <h1
          class="text-4xl md:text-6xl font-extrabold text-gray-900 dark:text-white tracking-tight font-mono mb-6"
        >
          {template.name}
          <span class="text-brand-500">Retro</span>
        </h1>

        <p
          class="text-xl text-gray-600 dark:text-gray-400 max-w-2xl mx-auto mb-10 leading-relaxed"
        >
          {template.description}
        </p>

        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a
            href={`/board/new?template=${template.id}`}
            class="px-8 py-4 bg-gray-900 dark:bg-white text-white dark:text-black font-bold rounded-xl shadow-lg hover:shadow-brand-500/25 hover:-translate-y-1 transition-all"
          >
            Use This Template Free
          </a>
          <a
            href="#how-it-works"
            class="px-8 py-4 bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white font-bold rounded-xl hover:bg-gray-200 dark:hover:bg-gray-700 transition-all"
          >
            How it Works
          </a>
        </div>
      </div>
    </div>

    {/* Columns Preview */}
    <div
      class="py-16 bg-gray-50 dark:bg-dark-900 border-y border-gray-200 dark:border-gray-800"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2
          class="text-2xl font-bold text-center text-gray-900 dark:text-white font-mono mb-12"
        >
          Template Structure
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          {
            template.columns.map((col) => (
              <div
                class="bg-white dark:bg-black p-6 rounded-xl border-t-4 shadow-sm border-gray-200 dark:border-gray-800"
                style={`border-top-color: var(--color-${col.color}-500, #cbd5e1)`}
              >
                <h3 class="font-bold text-lg text-gray-900 dark:text-white mb-2">
                  {col.title}
                </h3>
                <div class="h-32 bg-gray-50 dark:bg-dark-900 rounded-lg border-2 border-dashed border-gray-200 dark:border-gray-800 flex items-center justify-center text-gray-400 text-sm">
                  Add cards here...
                </div>
              </div>
            ))
          }
        </div>
      </div>
    </div>

    {/* Content Section for SEO */}
    <div id="how-it-works" class="py-20 max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="prose prose-lg dark:prose-invert mx-auto">
        <h3>When to use the {template.name} template?</h3>
        <p>
          The <strong>{template.name}</strong> format is one of the most effective
          ways to run an agile retrospective. It helps teams move beyond simple "good/bad"
          feedback and encourages deeper thinking about {
            template.columns.map((c) => c.title).join(", ")
          }.
        </p>

        <h3>How to run this retro on Clear Retro</h3>
        <ol>
          <li>
            <strong>Create Board:</strong> Click the button above to instantly generate
            a board with these columns.
          </li>
          <li>
            <strong>Invite Team:</strong> Share the URL. No login required for guests.
          </li>
          <li>
            <strong>Brainstorm:</strong> Give everyone 5-10 minutes to add cards to
            each column.
          </li>
          <li>
            <strong>Group & Vote:</strong> Use AI grouping to merge duplicates, then
            vote on the most important topics.
          </li>
          <li>
            <strong>Action Items:</strong> Create concrete action items to improve
            your next sprint.
          </li>
        </ol>
      </div>
    </div>
  </div>
</Layout>
