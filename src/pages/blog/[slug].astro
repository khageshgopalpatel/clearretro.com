---
import Layout from "../../layouts/Layout.astro";
import BlogPost from "../../components/pages/BlogPost";
import FAQSection from "../../components/FAQSection";
import { BLOG_POSTS } from "../../data/blogPosts";

export const prerender = true;

export function getStaticPaths() {
  return BLOG_POSTS.map((post) => ({
    params: { slug: post.slug },
  }));
}

const { slug } = Astro.params;
const post = BLOG_POSTS.find((p) => p.slug === slug);

if (!post) {
  return Astro.redirect("/404");
}
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: [
    {
      "@type": "ListItem",
      position: 1,
      name: "Home",
      item: "https://clearretro.com",
    },
    {
      "@type": "ListItem",
      position: 2,
      name: "Blog",
      item: "https://clearretro.com/blog",
    },
    {
      "@type": "ListItem",
      position: 3,
      name: post.title,
      item: `https://clearretro.com/blog/${post.slug}`,
    },
  ],
};

const articleSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  headline: post.title,
  description: post.excerpt,
  datePublished: new Date(post.date).toISOString(),
  dateModified: new Date(post.lastUpdated || post.date).toISOString(),
  image: post.image ? new URL(post.image, Astro.url).toString() : undefined,
  author: {
    "@type": "Organization",
    name: "Clear Retro",
    url: "https://clearretro.com",
  },
  ...(post.jsonLd || {}),
};

const schema = [breadcrumbSchema, articleSchema];
---

<Layout
  title={`${post.title} | Clear Retro Blog`}
  description={post.excerpt}
  image="/blog-placeholder.svg"
>
  <script
    type="application/ld+json"
    slot="head"
    set:html={JSON.stringify(schema)}
  />

  <BlogPost post={post}>
    {post.faqs && <FAQSection client:visible faqs={post.faqs} />}
  </BlogPost>
</Layout>
